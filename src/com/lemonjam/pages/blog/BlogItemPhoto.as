package com.lemonjam.pages.blog{	import flash.display.MovieClip;	import flash.events.Event;	import com.lemonjam.core.ImageLoader;	import com.greensock.*;	import flash.text.TextField;	import flash.text.TextFieldAutoSize;	import flash.text.TextFormatAlign;;	import com.lemonjam.util.HTMLTextUtil;	import com.lemonjam.ui.buttons.SecondaryButton;	import com.lemonjam.events.BlogEvent;		public class BlogItemPhoto extends BlogItemBase	{		private var _img:ImageLoader;		private var _loaded:Boolean = false;		private var _origHeight:Number = 0;		private var _origWidth:Number = 0;		private var _desc:TextField;				private var MARGIN:Number = 50;				private var _converter:HTMLTextUtil = new HTMLTextUtil();		private var _viewButton:SecondaryButton;				private var alt:String = "...";				public function BlogItemPhoto(aData:Object, index:Number, totalLength:Number, stageHeight:Number)		{			var tempDesc:String = _converter.convertText(aData.desc);						data = aData;			data.desc = tempDesc;						_bg.width = 160;						_desc = getChildByName("bodyTXT") as TextField;			_desc.autoSize = TextFormatAlign.LEFT;			_viewButton = getChildByName("buttonMC") as SecondaryButton;			_viewButton.setButton("VIEW POST", aData.url, true);					_viewButton.alpha = _desc.alpha = 0;			_isTXT.text = index.toString();			_ofTXT.text = totalLength.toString();			_bg.height = stageHeight - 201;			type = "photo";		}						public function loadContent():void		{			_img = new ImageLoader(data.photo);			_img.y = 105;			_img.x = 50;			_img.alpha = 0;			_img.addEventListener(Event.COMPLETE, _loadComplete);			this.addChild(_img);		}				private function _loadComplete(e:Event):void		{			_origHeight = _img.height;						var tempWidth:Number = _img.width;			var tempHeight:Number = _img.height;						if(tempHeight > tempWidth){				_img.height = (_origHeight > (_bg.height-155)) ? (_bg.height - 155) : _origHeight;				_img.scaleX = _img.scaleY;								_desc.y = _img.y;				_desc.x = _img.x + _img.width + 20;				_desc.width = 250;				_desc.height = _img.height;				_desc.text = data.desc;								tempWidth = _img.width + _desc.width + 20 + (MARGIN*2);			}						else {				if(_img.height > (_bg.height-250)){					_img.height = (_bg.height - 250);					_img.scaleX = _img.scaleY;				}								tempWidth = _img.width + (MARGIN*2);								_desc.y = _img.y + _img.height + 20;				_desc.width = _img.width;				_desc.text = data.desc;												var char:int = _desc.getLineOffset(2) - 1;				char -= alt.length;				char = _desc.text.substring(0, char + 1).search(/\S\s*$/);				_desc.text = _desc.text.substring(0, char) + alt;			}						_viewButton.alpha = 0;			_viewButton.x = _desc.x;			_viewButton.y = _desc.y + _desc.height + 14;									_hitbox.width = tempWidth;			TweenLite.to(_bg, .5, {width:tempWidth, onComplete:buildIn});		}						private function buildIn():void		{			TweenLite.to(_img, .3, {alpha:1, delay:.3});			TweenLite.to(_desc, .3, {alpha:1, delay:.3});			TweenLite.to(_viewButton, .3, {alpha:1, delay:.3});			loaded = true;						dispatchEvent(new BlogEvent(BlogEvent.BLOG_ITEM_COMPLETE, true));		}						public function resize():void		{			if(loaded){				var tempWidth:Number = _img.width;								if(_img.height > _img.width){					_img.height = (_origHeight > (_bg.height-155)) ? (_bg.height - 155) : _origHeight;					_img.scaleX = _img.scaleY;										_desc.y = _img.y;					_desc.x = _img.x + _img.width + 20;					_desc.width = 250;					_desc.height = _img.height;					_desc.text = data.desc;										tempWidth = _img.width + _desc.width + 20 + (MARGIN*2);				}				else {					if(_img.height > (_bg.height-250)){						_img.height = (_bg.height - 250);						_img.scaleX = _img.scaleY;					}										tempWidth = _img.width;										_desc.y = _img.y + _img.height + 20;					_desc.width = _img.width;										_desc.text = data.desc;										var char:int = _desc.getLineOffset(2) - 1;					char -= alt.length;					char = _desc.text.substring(0, char + 1).search(/\S\s*$/);					_desc.text = _desc.text.substring(0, char) + alt;				}				_desc.scrollV = 0;				_viewButton.x = _desc.x;				_viewButton.y = _desc.y + _desc.height + 14;								itemWidth = tempWidth;			}		}	}	}